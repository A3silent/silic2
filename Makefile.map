# Silic2 FPS Engine Makefile

# Compiler settings
CXX = g++
CC = gcc
CXXFLAGS = -std=c++17 -Wall -Wextra -O2 -g
CFLAGS = -Wall -O2 -g
LDFLAGS = -L./lib

# Include paths
INCLUDES = -I./include \
           -I./include/glad \
           -I./include/GLFW \
           -I./include/glm \
           -I./include/stb

# Libraries (Windows)
LIBS = -lglfw3 -lopengl32 -lgdi32 -luser32 -lkernel32

# Directories
BIN_DIR = bin

# Tell Make where to find source files by category
vpath %.cpp src/engine src/player src/enemy src/effects src/hud
vpath %.c   src/engine

# Source files grouped by category
ENGINE_SRCS  = main.cpp app.cpp camera.cpp collision.cpp shader.cpp texture.cpp \
               map.cpp map_renderer.cpp pixel_renderer.cpp simple_json.cpp \
               game_config.cpp
ENGINE_C     = glad.c

PLAYER_SRCS  = player.cpp weapon.cpp

ENEMY_SRCS   = enemy.cpp enemy_manager.cpp

EFFECTS_SRCS = particle_system.cpp groundparticle.cpp

HUD_SRCS     = crosshair.cpp minimap.cpp hud_renderer.cpp

# All object files (flattened into bin/)
ALL_CPP  = $(ENGINE_SRCS) $(PLAYER_SRCS) $(ENEMY_SRCS) $(EFFECTS_SRCS) $(HUD_SRCS)
APP_OBJS = $(patsubst %.cpp,$(BIN_DIR)/%.o,$(ALL_CPP)) \
           $(patsubst %.c,$(BIN_DIR)/%.o,$(ENGINE_C))

# Output binary
APP_TARGET = silic2.exe

# Default target
all: $(APP_TARGET)

# Link
$(APP_TARGET): $(APP_OBJS) | $(BIN_DIR)
	$(CXX) $(APP_OBJS) -o $@ $(LDFLAGS) $(LIBS)

# Create bin directory
$(BIN_DIR):
	if not exist $(BIN_DIR) mkdir $(BIN_DIR)

# Compile C++ sources (vpath resolves the actual location)
$(BIN_DIR)/%.o: %.cpp | $(BIN_DIR)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# Compile C sources
$(BIN_DIR)/%.o: %.c | $(BIN_DIR)
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

# Clean
clean:
	del /Q $(BIN_DIR)\*.o $(APP_TARGET) 2>nul || echo Clean completed

# Run targets
run: $(APP_TARGET)
	./$(APP_TARGET)

test-room: $(APP_TARGET)
	./$(APP_TARGET) res/maps/test_room.json

corridor: $(APP_TARGET)
	./$(APP_TARGET) res/maps/simple_corridor.json

textured-room: $(APP_TARGET)
	./$(APP_TARGET) res/maps/textured_room.json

.PHONY: all clean run test-room corridor textured-room
